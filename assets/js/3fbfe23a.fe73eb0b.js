"use strict";(self.webpackChunkdocusaurus_website=self.webpackChunkdocusaurus_website||[]).push([[885],{3905:(e,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>g});var t=a(7294);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){i(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,i=function(e,n){if(null==e)return{};var a,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=t.createContext({}),m=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},p=function(e){var n=m(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},k=t.forwardRef((function(e,n){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=m(a),k=i,g=c["".concat(s,".").concat(k)]||c[k]||d[k]||r;return a?t.createElement(g,l(l({ref:n},p),{},{components:a})):t.createElement(g,l({ref:n},p))}));function g(e,n){var a=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=k;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[c]="string"==typeof e?e:i,l[1]=o;for(var m=2;m<r;m++)l[m]=a[m];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}k.displayName="MDXCreateElement"},6915:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>m});var t=a(7462),i=(a(7294),a(3905));const r={title:"Flink on native k8s",date:new Date("2023-04-23T00:00:00.000Z"),tags:["Flink","Kubernetes"],categories:["\u6280\u672f\u5411"]},l="Flink on native k8s",o={unversionedId:"programming-column/Flink-on-native-k8s",id:"programming-column/Flink-on-native-k8s",title:"Flink on native k8s",description:"\u5728 Application Mode\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u63d0\u4ea4\uff08FLINK_HOME/bin/flink run-application\uff09\uff0c\u548c flink-kubernetes-operator \u65b9\u5f0f\uff0c\u540e\u8005\u662f\u5b98\u65b9\u4e3b\u63a8\u7684\u672a\u6765\u7684\u65b9\u5411\u3002",source:"@site/docs/programming-column/Flink-on-native-k8s.md",sourceDirName:"programming-column",slug:"/programming-column/Flink-on-native-k8s",permalink:"/docs/programming-column/Flink-on-native-k8s",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/programming-column/Flink-on-native-k8s.md",tags:[{label:"Flink",permalink:"/docs/tags/flink"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",frontMatter:{title:"Flink on native k8s",date:"2023-04-23T00:00:00.000Z",tags:["Flink","Kubernetes"],categories:["\u6280\u672f\u5411"]},sidebar:"tutorialSidebar",previous:{title:"\u521d\u63a2ELK\u65e5\u5fd7\u7ba1\u7406\u4f53\u7cfb",permalink:"/docs/programming-column/ELK"},next:{title:"k8s \u76f8\u5173",permalink:"/docs/programming-column/Kubernetes"}},s={},m=[{value:"\u524d\u63d0",id:"\u524d\u63d0",level:2},{value:"chart\u6e90",id:"chart\u6e90",level:3},{value:"\u955c\u50cf\u6982\u89c8",id:"\u955c\u50cf\u6982\u89c8",level:3},{value:"\u90e8\u7f72",id:"\u90e8\u7f72",level:2},{value:"\u90e8\u7f72flink-kubernetes-operator",id:"\u90e8\u7f72flink-kubernetes-operator",level:3},{value:"\u90e8\u7f72ingress-nginx",id:"\u90e8\u7f72ingress-nginx",level:3},{value:"\u90e8\u7f72redis",id:"\u90e8\u7f72redis",level:3},{value:"\u90e8\u7f72minio",id:"\u90e8\u7f72minio",level:3},{value:"\u90e8\u7f72juicefs-csi-driver",id:"\u90e8\u7f72juicefs-csi-driver",level:3},{value:"\u90e8\u7f72flink historyserver",id:"\u90e8\u7f72flink-historyserver",level:3},{value:"\u63d0\u4ea4\u4efb\u52a1",id:"\u63d0\u4ea4\u4efb\u52a1",level:2},{value:"\u95ee\u9898\u8bb0\u5f55",id:"\u95ee\u9898\u8bb0\u5f55",level:2},{value:"\u5e38\u7528\u547d\u4ee4",id:"\u5e38\u7528\u547d\u4ee4",level:2},{value:"\u5f15\u7528",id:"\u5f15\u7528",level:2},{value:"\u6269\u5c55\u9605\u8bfb",id:"\u6269\u5c55\u9605\u8bfb",level:2},{value:"\u9644\u5f55",id:"\u9644\u5f55",level:2},{value:"local-storage-redis.yaml",id:"local-storage-redisyaml",level:3},{value:"local-storage-minio.yaml",id:"local-storage-minioyaml",level:3},{value:"juicefs-csi-driver",id:"juicefs-csi-driver",level:3},{value:"flink-historyserver",id:"flink-historyserver",level:3},{value:"flink application deployment",id:"flink-application-deployment",level:3}],p={toc:m},c="wrapper";function d(e){let{components:n,...a}=e;return(0,i.kt)(c,(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"flink-on-native-k8s"},"Flink on native k8s"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXMtYXNjaWkiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxOTBweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjY3NnB4O2hlaWdodDoxOTBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA2NzYgMTkwIiB3aWR0aD0iNjc2cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTg1IiB4PSIxMCIgeT0iNzYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NSIgeD0iMjAiIHk9Ijk5LjI5MiI+RmxpbmsgUmVzb3VyY2UgUHJvdmlkZXM8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEzMCIgeD0iMjQ1IiB5PSIyMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMCIgeD0iMjU1IiB5PSI0Mi45OTUxIj5TdGFuZGFsb25lICYjMzUwNjQ7JiMyNjQyNjs8L3RleHQ+PHBhdGggZD0iTTE5NSw5NC40NDUzIEwyMDUsOTQuNDQ1MyBDMjIwLDk0LjQ0NTMgMjIwLDM4LjE0ODQgMjM1LDM4LjE0ODQgTDI0NSwzOC4xNDg0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE0NyIgeD0iMjQ1IiB5PSI3Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3IiB4PSIyNTUiIHk9Ijk5LjI5MiI+TmF0aXZlIEt1YmVybmV0ZXM8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIyMiIgeD0iNDQyIiB5PSI0OC4xNDg0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjAyIiB4PSI0NTIiIHk9IjcxLjE0MzYiPkFwcGxpY2F0aW9uIE1vZGUmIzY1Mjg4OyYjMjY0MTI7JiMyNTk5MTsmIzIwODY5OyYjMjM0ODE7JiM2NTI4OTs8L3RleHQ+PHBhdGggZD0iTTM5Miw5NC40NDUzIEw0MDIsOTQuNDQ1MyBDNDE3LDk0LjQ0NTMgNDE3LDY2LjI5NjkgNDMyLDY2LjI5NjkgTDQ0Miw2Ni4yOTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjExOCIgeD0iNDQyIiB5PSIxMDQuNDQ1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSI0NTIiIHk9IjEyNy40NDA0Ij5TZXNzaW9uIE1vZGU8L3RleHQ+PHBhdGggZD0iTTM5Miw5NC40NDUzIEw0MDIsOTQuNDQ1MyBDNDE3LDk0LjQ0NTMgNDE3LDEyMi41OTM4IDQzMiwxMjIuNTkzOCBMNDQyLDEyMi41OTM4ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTE5NSw5NC40NDUzIEwyMDUsOTQuNDQ1MyBDMjIwLDk0LjQ0NTMgMjIwLDk0LjQ0NTMgMjM1LDk0LjQ0NTMgTDI0NSw5NC40NDUzICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjU4IiB4PSIyNDUiIHk9IjEzMi41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzgiIHg9IjI1NSIgeT0iMTU1LjU4ODkiPllBUk48L3RleHQ+PHBhdGggZD0iTTE5NSw5NC40NDUzIEwyMDUsOTQuNDQ1MyBDMjIwLDk0LjQ0NTMgMjIwLDE1MC43NDIyIDIzNSwxNTAuNzQyMiBMMjQ1LDE1MC43NDIyICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLVNSQz1bRE95ekptOTE0OFJ4X0hMSjBlZDR1bjkzaGVBV2MyMTcyMFo2U2M3N295UGJ6eEF0VXVjVFhWWEhJS0taZFFzbkNyNTJfM0xvZVVDbFVEbjFFVXl5eS1JVE1jSWVEWENrc09JNnExSFN0Y3ctN2ZCYkI3Y1RfVnMtUlV3ZGY5SjdxQ0Q4TUpyNnc2ZUxTdU9IMElYMXRyMzlnNTBJT1ZGLWRJb01NVGdYWGlTODV0UTRNZ0I5czVyVTNxRjFuLWJJSVYwTG0tdGdFTGJ5OUZFZHpVRHFfVmNwTlJ0aW1KdjZxRzdBWkRWck5lVktDRXNQVG9NYUF3V3EweHlEQ1VnQ1RTZ0x1dWZSVGZwMjVSQks0OEJaV2JGckFZVVV3eUJXaVc2eFZQNEtwaGpqc0ZfMlU2R3E3emJUZW85ZnFQWDJwcWgzOS1ZMWo0QUdyajN0ZTZ6N0FLT0RtajBkZnRYM2hKMW05aVVBU0hidWdSZnZMMkxqQVdEQld5RFhHd0tVVlBURl9tMDBdLS0+PC9nPjwvc3ZnPg==",alt:"plantuml"})),(0,i.kt)("p",null,"\u5728 Application Mode\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u63d0\u4ea4\uff08FLINK_HOME/bin/flink run-application\uff09\uff0c\u548c flink-kubernetes-operator \u65b9\u5f0f\uff0c\u540e\u8005\u662f\u5b98\u65b9\u4e3b\u63a8\u7684\u672a\u6765\u7684\u65b9\u5411\u3002"),(0,i.kt)("h2",{id:"\u524d\u63d0"},"\u524d\u63d0"),(0,i.kt)("p",null,"\u6587\u672c\u5c06\u5728k8s\u96c6\u7fa4\u4e0a\u90e8\u7f72\u4e00\u5957flink application\u6a21\u5f0f\u73af\u5883\u3002"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"3\u8282\u70b9k8s\u96c6\u7fa4\u5df2\u5b58\u5728"),(0,i.kt)("li",{parentName:"ul"},"flink\u4efb\u52a1\u63d0\u4ea4\u91c7\u7528operator\u65b9\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"flink web\u8bbf\u95ee\u901a\u8fc7ingress"),(0,i.kt)("li",{parentName:"ul"},"flink\u65e5\u5fd7\u3001\u68c0\u67e5\u70b9\u3001\u5386\u53f2\u8bb0\u5f55\u7b49\u9700\u8981\u7528\u5230\u5b58\u50a8\u5377\uff0c\u91c7\u7528juicefs+redis+minio\u7684\u65b9\u6848")),(0,i.kt)("h3",{id:"chart\u6e90"},"chart\u6e90"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"helm repo add flink-operator-repo https://downloads.apache.org/flink/flink-kubernetes-operator-1.5.0/\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo add juicefs https://juicedata.github.io/charts/\n# redis\u3001minio\nhelm repo add bitnami https://charts.bitnami.com/bitnami\n")),(0,i.kt)("h3",{id:"\u955c\u50cf\u6982\u89c8"},"\u955c\u50cf\u6982\u89c8"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"\u8f6f\u4ef6"),(0,i.kt)("th",{parentName:"tr",align:null},"\u955c\u50cf"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"juicefs-csi-driver"),(0,i.kt)("td",{parentName:"tr",align:null},"juicedata/juicefs-csi-driver:v0.19.0",(0,i.kt)("br",null),"juicedata/mount:ce-v1.0.4",(0,i.kt)("br",null),"quay.io/k8scsi/csi-node-driver-registrar:v2.1.0",(0,i.kt)("br",null),"quay.io/k8scsi/csi-provisioner:v1.6.0",(0,i.kt)("br",null),"quay.io/k8scsi/livenessprobe:v1.1.0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"minio"),(0,i.kt)("td",{parentName:"tr",align:null},"bitnami/minio:2023.7.18-debian-11-r0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"redis"),(0,i.kt)("td",{parentName:"tr",align:null},"bitnami/redis:7.0.12-debian-11-r15",(0,i.kt)("br",null),"bitnami/redis-sentinel:7.0.12-debian-11-r13")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"flink-kubernetes-operator"),(0,i.kt)("td",{parentName:"tr",align:null},"quay.io/jetstack/cert-manager-controller:v1.8.2",(0,i.kt)("br",null),"quay.io/jetstack/cert-manager-cainjector:v1.8.2",(0,i.kt)("br",null),"quay.io/jetstack/cert-manager-webhook:v1.8.2",(0,i.kt)("br",null),(0,i.kt)("br",null),"apache/flink-kubernetes-operator:be07be7")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ingress-nginx"),(0,i.kt)("td",{parentName:"tr",align:null},"registry.k8s.io/ingress-nginx/controller:v1.8.1",(0,i.kt)("br",null),"registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230407")))),(0,i.kt)("h2",{id:"\u90e8\u7f72"},"\u90e8\u7f72"),(0,i.kt)("h3",{id:"\u90e8\u7f72flink-kubernetes-operator"},"\u90e8\u7f72flink-kubernetes-operator"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u524d\u63d0\nkubectl create -f https://github.com/jetstack/cert-manager/releases/download/v1.8.2/cert-manager.yaml\n\n# \u5b89\u88c5\nhelm install flink-kubernetes-operator flink-operator-repo/flink-kubernetes-operator \\\n  --version 1.5.0 \\\n  --namespace flink --create-namespace \\\n  --set image.repository=apache/flink-kubernetes-operator\n")),(0,i.kt)("h3",{id:"\u90e8\u7f72ingress-nginx"},"\u90e8\u7f72ingress-nginx"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u5b89\u88c5\nhelm install ingress-nginx ingress-nginx/ingress-nginx \\\n  --version 4.7.1 \\\n  --namespace ingress-nginx --create-namespace \\\n  --set controller.image.digest='' \\\n  --set controller.admissionWebhooks.patch.image.digest='' \\\n  --set controller.service.type=NodePort \\\n  --set controller.hostNetwork=true \\\n  --set controller.replicaCount=1\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Tips\uff1a\n1.controller.service.type \u9ed8\u8ba4\u662fLB\uff0c\u56e0\u4e3a\u6ca1\u6709\u6240\u4ee5\u6539\u6210NodePort\n2.\u9ed8\u8ba4\u955c\u50cf\u540d\u662f\u5e26digest\u7684\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u62c9\u53d6\u4e0d\u5230\u955c\u50cf\u3002")),(0,i.kt)("p",null,"\u5230\u8fd9\u91cc\u5c31\u53ef\u4ee5\u63d0\u4ea4\u4e00\u4e2aflink\u5b98\u65b9\u793a\u4f8b\u4e2d\u7684\u72b6\u6001\u673a\u4efb\u52a1\uff0c\u6765\u8fdb\u884c\u9636\u6bb5\u6027\u9a8c\u8bc1\u4e86\u3002"),(0,i.kt)("h3",{id:"\u90e8\u7f72redis"},"\u90e8\u7f72redis"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u521b\u5efaredis\u7684local-storage\nkubectl apply -f local-storage-redis.yaml\n\n# \u5b89\u88c5\nhelm install redis bitnami/redis \\\n  --version 17.14.3 --namespace redis --create-namespace \\\n  --set auth.enabled=false,auth.sentinel=false \\\n  --set global.storageClass=local-storage-redis \\\n  --set replica.persistence.size=2Gi \\\n  --set sentinel.enabled=true,sentinel.quorum=2\n")),(0,i.kt)("h3",{id:"\u90e8\u7f72minio"},"\u90e8\u7f72minio"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u521b\u5efaredis\u7684local-storage\nkubectl apply -f local-storage-minio.yaml\n\n# \u5b89\u88c5\nhelm install minio bitnami/minio \\\n  --version 12.6.10 --namespace minio --create-namespace \\\n  --set auth.rootUser=minioadmin,auth.rootPassword=minioadmin \\\n  --set mode=distributed,statefulset.replicaCount=3,statefulset.drivesPerNode=2 \\\n  --set persistence.storageClass=local-storage-minio,persistence.size=20Gi \\\n  --set service.type=NodePort\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5b98\u65b9\u63d0\u4f9b\u4e86\u6700\u65b0\u7684operator\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8bd5\u8bd5")),(0,i.kt)("h3",{id:"\u90e8\u7f72juicefs-csi-driver"},"\u90e8\u7f72juicefs-csi-driver"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u5b89\u88c5\nhelm install juicefs-csi-driver juicefs/juicefs-csi-driver -f ./custom-values.yaml \\\n  --version 0.15.1 \\\n  --namespace juicefs --create-namespace\n")),(0,i.kt)("h3",{id:"\u90e8\u7f72flink-historyserver"},"\u90e8\u7f72flink historyserver"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u521b\u5efahistory pvc\nkubectl apply -f flink-historyserver-pvc.yaml\n\n# \u521b\u5efahistory configmap\nkubectl apply -f flink-historyserver-conf.yaml\n\n# \u521b\u5efahistoryserver deployment\nkubectl apply -f flink-historyserver.yaml\n")),(0,i.kt)("h2",{id:"\u63d0\u4ea4\u4efb\u52a1"},"\u63d0\u4ea4\u4efb\u52a1"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# \u63d0\u4ea4\u4efb\u52a1\nkubectl apply -f flink-application-deployment.yaml\n")),(0,i.kt)("h2",{id:"\u95ee\u9898\u8bb0\u5f55"},"\u95ee\u9898\u8bb0\u5f55"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"helm\u5b89\u88c5\u65f6\u5361\u5f88\u4e45\u7136\u540e\u5931\u8d25\n\u90e8\u5206chart\u4ed3\u5e93\u53ef\u80fd\u5728github\u4e0a\uff0c\u6240\u4ee5\u4f1a\u4e0b\u8f7d\u4e0d\u4e0b\u6765\uff0c\u9700\u8981\u624b\u52a8\u4e0b\u8f7d\uff0c\u7136\u540e\u901a\u8fc7\u672c\u5730chart\u5305\u65b9\u5f0f\u5b89\u88c5")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f7f\u7528 Minikube \u7684\u8bdd\uff0c\u7531\u4e8e\u5728\u5bb9\u5668\u91cc\uff0cport-forward \u5bbf\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-Shell"},"# --address \u63a5\u53d7\u6240\u6709\u6d41\u91cf\nkubectl port-forward --address 0.0.0.0 pod/nginx 80:80\n")),(0,i.kt)("h2",{id:"\u5e38\u7528\u547d\u4ee4"},"\u5e38\u7528\u547d\u4ee4"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'# \u58f0\u660e\u67d0\u4e2asc\u4e3a\u9ed8\u8ba4sc\nkubectl patch storageclass juicefs-sc -p \'{"metadata":{"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n')),(0,i.kt)("h2",{id:"\u5f15\u7528"},"\u5f15\u7528"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-release-1.4/docs/try-flink-kubernetes-operator/quick-start/"},"flink-kubernetes-operator Quick Start")," \u5b98\u65b9demo"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.zhihu.com/people/0700360208/posts"},"Flink On K8s\u5b9e\u8df5")," \u6587\u7ae0\u548c\u89c6\u9891\u8d44\u6599\u6bd4\u8f83\u7cfb\u7edf\uff0c\u8d28\u91cf\u9ad8"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.cnblogs.com/liugp/p/16755095.html#4application%E6%A8%A1%E5%BC%8F%E6%8E%A8%E8%8D%90"},"\u3010\u4e91\u539f\u751f\u3011Flink on k8s \u8bb2\u89e3\u4e0e\u5b9e\u6218\u64cd\u4f5c")," \u9009\u8bfb")),(0,i.kt)("h2",{id:"\u6269\u5c55\u9605\u8bfb"},"\u6269\u5c55\u9605\u8bfb"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.aliyun.com/article/913111"},"Native Flink on Kubernetes \u5728\u5c0f\u7ea2\u4e66\u7684\u5b9e\u8df5"),"\n",(0,i.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/66054038b9ac"},"\u3010Flink on k8s\u3011Native Kubernetes Application \u90e8\u7f72\u6a21\u5f0f\u8be6\u89e3")),(0,i.kt)("h2",{id:"\u9644\u5f55"},"\u9644\u5f55"),(0,i.kt)("h3",{id:"local-storage-redisyaml"},"local-storage-redis.yaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"local-storage-redis.yaml","local-storage-redis.yaml":!0},"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: local-storage-redis\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: redis-local-pv-0\nspec:\n  capacity:\n    storage: 2Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-redis\n  local:\n    path: /data/redis\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - master1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: redis-local-pv-1\nspec:\n  capacity:\n    storage: 2Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-redis\n  local:\n    path: /data/redis\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: redis-local-pv-2\nspec:\n  capacity:\n    storage: 2Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-redis\n  local:\n    path: /data/redis\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node2\n")),(0,i.kt)("h3",{id:"local-storage-minioyaml"},"local-storage-minio.yaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"local-storage-minio.yaml","local-storage-minio.yaml":!0},"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: local-storage-minio\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-0\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio1\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - master1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-1\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio2\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - master1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-2\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio1\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-3\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio2\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node1\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-4\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio1\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node2\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: minio-local-pv-5\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage-minio\n  local:\n    path: /data/minio2\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node2\n\n")),(0,i.kt)("h3",{id:"juicefs-csi-driver"},"juicefs-csi-driver"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"custom-values.yaml","custom-values.yaml":!0},'# helm\u4ee3\u4e3a\u521b\u5efasc\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u624b\u52a8\u521b\u5efa\nstorageClasses:\n- name: juicefs-sc\n  enabled: true\n  reclaimPolicy: Delete\n  annotations:\n    storageclass.kubernetes.io/is-default-class: "true"\n  # JuiceFS \u6587\u4ef6\u7cfb\u7edf\u8ba4\u8bc1\u4fe1\u606f\n  # \u5982\u679c\u5df2\u7ecf\u63d0\u524d\u521b\u5efa\u597d\u6587\u4ef6\u7cfb\u7edf\uff0c\u5219\u53ea\u9700\u586b\u5199 `name` \u548c `metaurl` \u8fd9\u4e24\u9879\n  backend:\n    name: "myjuicefs"\n    metaurl: redis://mymaster,redis.redis.svc.cluster.local:26379/0\n    # metaurl: "redis://redis.redis.svc.cluster.local:6379/0"\n    storage: "minio"\n    accessKey: "minioadmin"\n    secretKey: "minioadmin"\n    bucket: "http://minio.minio.svc.cluster.local:9000/myjfs"\n    # \u8bbe\u7f6e Mount Pod \u65f6\u533a\uff0c\u9ed8\u8ba4\u4e3a UTC\u3002\n    envs: "{TZ: Asia/Shanghai}"\n  # Mount pod \u7684\u8d44\u6e90\u914d\u7f6e\n  mountPod:\n    resources:\n      requests:\n        cpu: 50m\n        memory: "64Mi"\n      limits:\n        cpu: 100m\n        memory: "256Mi"\n')),(0,i.kt)("h3",{id:"flink-historyserver"},"flink-historyserver"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"flink-historyserver-pvc.yaml","flink-historyserver-pvc.yaml":!0},"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: flink-historyserver-pvc  # jar pvc\u540d\u79f0\n  namespace: flink-etl\nspec:\n  storageClassName: juicefs-sc   #sc\u540d\u79f0\n  accessModes:\n    - ReadWriteMany   #\u91c7\u7528ReadOnlyMany\u7684\u8bbf\u95ee\u6a21\u5f0f\n  resources:\n    requests:\n      storage: 5Gi    #\u5b58\u50a8\u5bb9\u91cf\uff0c\u6839\u636e\u5b9e\u9645\u9700\u8981\u66f4\u6539\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"flink-historyserver-conf.yaml","flink-historyserver-conf.yaml":!0},"kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: flink-historyserver-conf\n  namespace: flink-etl\n  annotations:\n    kubesphere.io/creator: admin\ndata:\n  flink-conf.yaml: |\n    blob.server.port: 6124\n    kubernetes.jobmanager.annotations: flinkdeployment.flink.apache.org/generation:2\n    kubernetes.jobmanager.replicas: 1\n    kubernetes.jobmanager.cpu: 100m\n    $internal.flink.version: v1_16\n    kubernetes.taskmanager.cpu: 100m\n    jobmanager.rpc.port: 6123\n    taskmanager.rpc.port: 6122\n    kubernetes.service-account: flink\n    kubernetes.cluster-id: flink-historyserver\n    kubernetes.container.image: flink:1.16.0-scala_2.12-java11\n    parallelism.default: 1\n    kubernetes.namespace: flink-etl\n    taskmanager.numberOfTaskSlots: 3\n    kubernetes.rest-service.exposed.type: ClusterIP\n    kubernetes.operator.reconcile.interval: 15 s\n    kubernetes.operator.metrics.reporter.slf4j.interval: 5 MINUTE\n    kubernetes.operator.metrics.reporter.slf4j.factory.class: org.apache.flink.metrics.slf4j.Slf4jReporterFactory\n    jobmanager.memory.process.size: 1024m\n    taskmanager.memory.process.size: 1024m\n    kubernetes.internal.jobmanager.entrypoint.class: org.apache.flink.kubernetes.entrypoint.KubernetesSessionClusterEntrypoint\n    kubernetes.pod-template-file: /tmp/flink_op_generated_podTemplate_17272077926352838674.yaml\n    execution.target: kubernetes-session\n    jobmanager.archive.fs.dir: file:///opt/flink/flink_history\n    historyserver.archive.fs.dir: file:///opt/flink/flink_history\n    historyserver.archive.fs.refresh-interval: 10000\n    historyserver.web.port: 8082\n    web.tmpdir: /opt/flink/webupload\n    web.upload.dir: /opt/flink/webupload\n    web.cancel.enable: false\n    internal.cluster.execution-mode: NORMAL\n    queryable-state.proxy.ports: 6125\n    state.checkpoints.dir: file:///opt/flink/checkpoints\n  log4j.properties: |\n    # Allows this configuration to be modified at runtime. The file will be checked every 30 seconds.\n    monitorInterval=30\n    # This affects logging for both user code and Flink\n    rootLogger.level = INFO\n    rootLogger.appenderRef.file.ref = MainAppender\n    # Uncomment this if you want to _only_ change Flink's logging\n    #logger.flink.name = org.apache.flink\n    #logger.flink.level = INFO\n    # The following lines keep the log level of common libraries/connectors on\n    # log level INFO. The root logger does not override this. You have to manually\n    # change the log levels here.\n    logger.akka.name = akka\n    logger.akka.level = INFO\n    logger.kafka.name= org.apache.kafka\n    logger.kafka.level = INFO\n    logger.hadoop.name = org.apache.hadoop\n    logger.hadoop.level = INFO\n    logger.zookeeper.name = org.apache.zookeeper\n    logger.zookeeper.level = INFO\n    logger.shaded_zookeeper.name = org.apache.flink.shaded.zookeeper3\n    logger.shaded_zookeeper.level = INFO\n    # Log all infos in the given file\n    appender.main.name = MainAppender\n    appender.main.type = RollingFile\n    appender.main.append = true\n    appender.main.fileName = ${sys:log.file}\n    appender.main.filePattern = ${sys:log.file}.%i\n    appender.main.layout.type = PatternLayout\n    appender.main.layout.pattern = %d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n    appender.main.policies.type = Policies\n    appender.main.policies.size.type = SizeBasedTriggeringPolicy\n    appender.main.policies.size.size = 100MB\n    appender.main.policies.startup.type = OnStartupTriggeringPolicy\n    appender.main.strategy.type = DefaultRolloverStrategy\n    appender.main.strategy.max = ${env:MAX_LOG_FILE_NUMBER:-10}\n    # Suppress the irrelevant (wrong) warnings from the Netty channel handler\n    logger.netty.name = org.jboss.netty.channel.DefaultChannelPipeline\n    logger.netty.level = OFF\n  log4j-console.properties: |\n    # This affects logging for both user code and Flink\n    rootLogger.level = INFO\n    rootLogger.appenderRef.console.ref = ConsoleAppender\n    rootLogger.appenderRef.rolling.ref = RollingFileAppender\n     \n    # Uncomment this if you want to _only_ change Flink's logging\n    #logger.flink.name = org.apache.flink\n    #logger.flink.level = INFO\n     \n    # The following lines keep the log level of common libraries/connectors on\n    # log level INFO. The root logger does not override this. You have to manually\n    # change the log levels here.\n    logger.akka.name = akka\n    logger.akka.level = INFO\n    logger.kafka.name= org.apache.kafka\n    logger.kafka.level = INFO\n    logger.hadoop.name = org.apache.hadoop\n    logger.hadoop.level = INFO\n    logger.zookeeper.name = org.apache.zookeeper\n    logger.zookeeper.level = INFO\n     \n    # Log all infos to the console\n    appender.console.name = ConsoleAppender\n    appender.console.type = CONSOLE\n    appender.console.layout.type = PatternLayout\n    appender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n     \n    # Log all infos in the given rolling file\n    appender.rolling.name = RollingFileAppender\n    appender.rolling.type = RollingFile\n    appender.rolling.append = false\n    appender.rolling.fileName = ${sys:log.file}\n    appender.rolling.filePattern = ${sys:log.file}.%i\n    appender.rolling.layout.type = PatternLayout\n    appender.rolling.layout.pattern = %d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n    appender.rolling.policies.type = Policies\n    appender.rolling.policies.size.type = SizeBasedTriggeringPolicy\n    appender.rolling.policies.size.size=100MB\n    appender.rolling.strategy.type = DefaultRolloverStrategy\n    appender.rolling.strategy.max = 10\n     \n    # Suppress the irrelevant (wrong) warnings from the Netty channel handler\n    logger.netty.name = org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline\n    logger.netty.level = OFF\n     \n    # Flink Deployment Logging Overrides\n    # rootLogger.level = DEBUG\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"flink-historyserver-deployment.yaml","flink-historyserver-deployment.yaml":!0},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: flink-etl\n  labels:\n    app: flink-historyserver\n    name: flink-historyserver\n  name: flink-historyserver\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      name: flink-historyserver\n  template:\n    metadata:\n      namespace: flink-etl\n      labels:\n        app: flink-historyserver\n        name: flink-historyserver\n    spec:\n      containers:\n        - name: flink-historyserver\n          env:\n            - name: TZ\n              value: Asia/Shanghai\n          image: flink:1.16.0-scala_2.12-java11\n          command: [ 'sh','-c','/docker-entrypoint.sh history-server' ]\n          ports:\n              - containerPort: 8082\n          volumeMounts:\n            - name: flink-historyserver-conf\n              mountPath: /opt/flink/conf/flink-conf.yaml\n              subPath: flink-conf.yaml\n            - name: flink-historyserver-conf\n              mountPath: /opt/flink/conf/log4j.properties\n              subPath: log4j.properties\n            - name: flink-historyserver-conf\n              mountPath: /opt/flink/conf/log4j-console.properties\n              subPath: log4j-console.properties\n            - name: flink-historyserver\n              mountPath: /opt/flink/flink_history\n      volumes:  # \u6302\u8f7d\u5377\u914d\u7f6e\n        - name: flink-historyserver-conf\n          configMap:\n            name: flink-historyserver-conf\n        - name: flink-historyserver\n          persistentVolumeClaim:\n            claimName: flink-historyserver-pvc\n# ---\n# kind: Service\n# apiVersion: v1\n# metadata:\n#   namespace: flink\n#   name: flink-historyserver\n# spec:\n#   type: NodePort\n#   ports:\n#     - port: 8082\n#       nodePort: 31082\n#   selector:\n#     name: flink-historyserver\n\n# ingress\u6309\u5b9e\u9645\u60c5\u51b5\u914d\u7f6e\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: flink-historyserver\n    name: flink-historyserver\n  name: flink-historyserver\n  namespace: flink-etl\nspec:\n  selector:\n    app: flink-historyserver\n  ports:\n    - port: 8082\n      protocol: TCP\n      targetPort: 8082\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  namespace: flink-etl\n  name: flink-historyserver\n  annotations:\n    nginx.ingress.kubernetes.io/default-backend: ingress-nginx-controller\n    nginx.ingress.kubernetes.io/use-regex: 'true'\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: \"flink-hs.k8s.io\"\n      http:\n        paths:\n          - pathType: Prefix\n            path: \"/\"\n            backend:\n              service:\n                name: flink-historyserver\n                port:\n                  number: 8082\n")),(0,i.kt)("h3",{id:"flink-application-deployment"},"flink application deployment"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"flink-log-pvc.yaml","flink-log-pvc.yaml":!0},"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: flink-log-pvc\n  namespace: flink-etl\nspec:\n  storageClassName: juicefs-sc\n  accessModes:\n    - ReadWriteMany   #\u91c7\u7528ReadOnlyMany\u7684\u8bbf\u95ee\u6a21\u5f0f\n  resources:\n    requests:\n      storage: 10Gi\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"flink-application-deployment","flink-application-deployment":!0},'apiVersion: flink.apache.org/v1beta1\nkind: FlinkDeployment\nmetadata:\n  namespace: flink\n  name: application-flink\nspec:\n  image: flink:1.16.0-scala_2.12-java11\n  flinkVersion: v1_16\n  imagePullPolicy: IfNotPresent   # \u955c\u50cf\u62c9\u53d6\u7b56\u7565\uff0c\u672c\u5730\u6ca1\u6709\u5219\u4ece\u4ed3\u5e93\u62c9\u53d6\n  ingress:   # ingress\u914d\u7f6e\uff0c\u7528\u4e8e\u8bbf\u95eeflink web\u9875\u9762\n#    template: "flink.k8s.io/{{namespace}}/{{name}}(/|$)(.*)"\n    template: "/{{namespace}}/{{name}}(/|$)(.*)"\n    className: "nginx"\n    annotations:\n      nginx.ingress.kubernetes.io/rewrite-target: "/$2"\n  flinkConfiguration:\n    taskmanager.numberOfTaskSlots: "3"\n    jobmanager.archive.fs.dir: file:///opt/flink/flink_history      # JobManager \u5f52\u6863\u8def\u5f84\n  serviceAccount: flink\n  jobManager:\n    replicas: 1\n    resource:\n      memory: "1024m"\n      cpu: 1\n  taskManager:\n    replicas: 1\n    resource:\n      memory: "1024m"\n      cpu: 1\n  podTemplate:\n    spec:\n      containers:\n        - name: flink-main-container\n          volumeMounts:\n            - name: flink-jar\n              mountPath: /opt/flink/jar\n            - name: flink-log\n              mountPath: /opt/flink/log  \n            - name: flink-historyserver\n              mountPath: /opt/flink/flink_history\n      volumes:\n        - name: flink-jar\n          persistentVolumeClaim:\n            claimName: flink-jar-pvc\n        - name: flink-log\n          persistentVolumeClaim:\n            claimName: flink-log-pvc    \n        - name: flink-historyserver\n          persistentVolumeClaim:\n            claimName: flink-historyserver-pvc\n  job:\n    jarURI: local:///opt/flink/examples/streaming/StateMachineExample.jar\n#    entryClass: \n    args:\n      - --conf_path\n      - /opt/flink/jar/1.json\n      - --plugin_home\n      - /opt/flink/jar/connector_plugin\n    parallelism: 1\n    upgradeMode: stateless\n')))}d.isMDXComponent=!0}}]);